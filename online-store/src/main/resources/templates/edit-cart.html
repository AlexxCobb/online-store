<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: common-header('Edit-Cart')}">
</head>
<body>
<div th:replace="~{fragments/navbar :: main-navbar}"></div>

<div class="welcome-container">
    <h2>–¢–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ</h2>
    <div th:if="${cart == null or cart.cartItems == null or cart.cartItems.empty}">
        <p class="text-muted">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
    </div>
    <div th:if="${successMessage}" class="alert alert-success">
        <span th:text="${successMessage}"></span>
    </div>
    <div th:if="${errorMessage}" class="alert alert-danger">
        <span th:text="${errorMessage}"></span>
    </div>

    <div th:if="${cart != null and cart.cartItems != null and not cart.cartItems.empty}">
        <div class="d-flex justify-content-end mb-3">
            <form th:action="@{/api/users/cart}" method="post">
                <input type="hidden" name="_method" value="delete"/>
                <button type="submit" class="btn btn-outline-danger btn-sm">
                    <i class="bi bi-trash me-1"></i> –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
                </button>
            </form>
        </div>
        <table>
            <tr>
                <th></th>
                <th>–ë—Ä–µ–Ω–¥</th>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏</th>
                <th>–¶–≤–µ—Ç</th>
                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ, —à—Ç</th>
                <th>–°—Ç–æ–∏–º–æ—Å—Ç—å, ‚ÇΩ</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
            <tr th:each="cartItem : ${cart.cartItems}">
                <td>
                    <img th:src="@{${cartItem.imagePath != null ? cartItem.imagePath : '/images/WI-BI.png'}}"
                         class="product-thumbnail"/>
                </td>
                <td th:text="${cartItem.brand}"></td>
                <td th:text="${cartItem.name}"></td>
                <td th:text="${cartItem.color}"></td>
                <td th:text="${cartItem.quantity}"></td>
                <td th:text="${cartItem.price}"></td>
                <td>
                    <form th:action="@{'/api/users/cart/' + ${cartItem.publicProductId}}" method="post">
                        <input type="hidden" name="_method" value="patch"/>
                        <button type="submit" class="btn btn-outline-danger btn-sm">
                            <i class="bi bi-x-circle"></i> –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </form>
                </td>
            </tr>
        </table>
    </div>
</div>

<div th:if="${cart != null and cart.cartItems != null and not cart.cartItems.empty}">
    <div class="welcome-container p">
        <table>
            <tr>
                <th>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —à—Ç</th>
                <th>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å, —Ä—É–±</th>
            </tr>
            <tr>
                <td th:text="${cart.totalQuantity}"></td>
                <td th:text="${cart.totalPrice}"></td>
            </tr>
        </table>
    </div>
</div>


<div class="welcome-container" th:if="${cart != null and cart.cartItems != null and not cart.cartItems.empty}">
    <table>
        <form th:action="@{'/api/users/' + ${publicUserId} + '/orders'}"
              method="post">

            <div class="mb-3">
                <label class="form-label ">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</label>
                <div class="input-group">
                    <select name="paymentMethodName" class="form-select">
                        <option th:each="paymentMethod : ${paymentMethods}"
                                th:value="${paymentMethod}"
                                th:text="${paymentMethod.displayValue}">
                        </option>
                    </select>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏:</label>
                <select name="deliveryMethodName" class="form-select">
                    <option th:each="deliveryMethod : ${deliveryMethods}"
                            th:value="${deliveryMethod}"
                            th:text="${deliveryMethod.displayValue}">
                    </option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</label>

                <div class="card mb-3" th:if="${not userAddresses.empty}">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üè† –ú–æ–∏ –∞–¥—Ä–µ—Å–∞</h5>
                    </div>
                    <div class="card-body">
                        <div th:each="address : ${userAddresses}" class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="publicAddressId"
                                   th:id="${'address_' + address.publicAddressId}"
                                   th:value="${address.publicAddressId}">
                            <label class="form-check-label" th:for="${'address_' + address.publicAddressId}">
                                <span th:text="${address.zipCode + ', ' + address.town + ', ' + address.street + ', ' + address.houseNumber + (address.flatNumber != null ? ', –∫–≤. ' + address.flatNumber : '')}"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="card mb-3" th:if="${not parcelAddresses.empty}">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">üì¶ –ü—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</h5>
                    </div>
                    <div class="card-body">
                        <div th:each="address : ${parcelAddresses}" class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="publicAddressId"
                                   th:id="${'address_' + address.publicAddressId}"
                                   th:value="${address.publicAddressId}">
                            <label class="form-check-label" th:for="${'address_' + address.publicAddressId}">
                                <span th:text="${address.zipCode + ', ' + address.town + ', ' + address.street + ', ' + address.houseNumber}"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="card mb-3" th:if="${not storeAddresses.empty}">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">üè¨ –ú–∞–≥–∞–∑–∏–Ω—ã</h5>
                    </div>
                    <div class="card-body">
                        <div th:each="address : ${storeAddresses}" class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="publicAddressId"
                                   th:id="${'address_' + address.publicAddressId}"
                                   th:value="${address.publicAddressId}">
                            <label class="form-check-label" th:for="${'address_' + address.publicAddressId}">
                                <span th:text="${address.zipCode + ', ' + address.town + ', ' + address.street + ', ' + address.houseNumber}"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                <a th:href="@{'/api/users/cart'}"
                   class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </table>
</div>

<footer th:replace="~{fragments/footer :: copy}"></footer>
</body>
</html>